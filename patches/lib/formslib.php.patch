diff --git a/lib/formslib.php b/lib/formslib.php
index 759f546..7592da9 100644
--- a/lib/formslib.php
+++ b/lib/formslib.php
@@ -1145,6 +1145,10 @@ class MoodleQuickForm extends HTML_QuickForm_DHTMLRulesTableless {
             }
         }
 
+        if (is_array($this->_constantValues)) {
+            $unfiltered = HTML_QuickForm::arrayMerge($unfiltered, $this->_constantValues);
+        }
+
         if ($addslashes){
             return $this->_recursiveFilter('addslashes', $unfiltered);
         } else {
@@ -1424,7 +1428,7 @@ function validate_' . $this->_formName . '(frm) {
         $iname = $this->getAttribute('id').'items';
         $js = '<script type="text/javascript">'."\n";
         $js .= '//<![CDATA['."\n";
-        $js .= "var $iname = Array();\n";
+        $js .= "$iname = Array();\n";
 
         foreach ($this->_dependencies as $dependentOn => $conditions){
             $js .= "{$iname}['$dependentOn'] = Array();\n";
