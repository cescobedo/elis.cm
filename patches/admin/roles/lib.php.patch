diff --git a/admin/roles/lib.php b/admin/roles/lib.php
index 442d3d2..01eac0a 100644
--- a/admin/roles/lib.php
+++ b/admin/roles/lib.php
@@ -569,21 +569,20 @@ class define_role_table_advanced extends capability_table_with_risks {
         );
 
         //RL edit - allow custom context levels to be selected
-        if ($context_levels = $DB->get_recordset('context_levels', null, 'id')) {
-            foreach ($context_levels as $context_level) {
-                //add 1000 to the context ids to prevent conflicts
-                $context_id = $context_level->id + 1000;
+        if (class_exists('context_elis_helper') && ($context_levels = context_elis_helper::get_legacy_levels())) {
+            foreach ($context_levels as $context_level_name => $context_id) {
+                $ctxclass = context_elis_helper::get_class_for_level($context_id);
 
                 //default string display name can be overridden specifically for this display
                 //by setting this language string for the context level's component
-                $override_string_name = "context_level_{$context_level->name}";
+                $override_string_name = "context_level_{$context_level_name}";
 
-                if (get_string_manager()->string_exists($override_string_name, $context_level->component)) {
+                if (get_string_manager()->string_exists($override_string_name, $ctxclass::get_component())) {
                     //name override
-                    $display_string = get_string($override_string_name, $context_level->component);
+                    $display_string = get_string($override_string_name, $ctxclass::get_component());
                 } else {
                     //standard entity name
-                    $display_string = get_string($context_level->name, $context_level->component);
+                    $display_string = get_string($context_level_name, $ctxclass::get_component());
                 }
 
                 $this->allcontextlevels[$context_id] = $display_string;
